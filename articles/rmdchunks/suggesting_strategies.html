<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • sctree</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">sctree</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/sctree.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/antibody_query.html">Query Antibody vendors from inside R</a>
    </li>
    <li>
      <a href="../../articles/plot_flowstyle.html">Flow style plotting</a>
    </li>
    <li>
      <a href="../../articles/rmdchunks/suggesting_strategies.html">UNKNOWN TITLE</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1></h1>
            
      
      
      <div class="hidden name"><code>suggesting_strategies.Rmd</code></div>

    </div>

    
    
<div id="suggesting-a-gating-strategy-for-the-markers" class="section level2">
<h2 class="hasAnchor">
<a href="#suggesting-a-gating-strategy-for-the-markers" class="anchor"></a>Suggesting a gating strategy for the markers</h2>
<p>A general strategy to get separate all clusters</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">top_markers</a></code></pre></div>
<pre><code>## [1] "MZB1" "CD3G" "CD3D" "ASNS" "CA2"  "HEY1"</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">tree_fit &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/fit_ctree.html">fit_ctree</a></span>(small_<span class="dv">5050</span>_mix,</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">                      <span class="dt">genes_use =</span> top_markers,</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">                      <span class="dt">cluster =</span> <span class="st">"ALL"</span>)</a></code></pre></div>
<pre><code>## Warning: The following arguments are not used: uniq, cells.use</code></pre>
<pre><code>## Suggested parameter: cells instead of cells.use</code></pre>
<p>Visualizing the tree as … a tree … we can see how our model is a simple series of yes/no questions.</p>
<p>If we wanted to classifiy a random cell: in the first <code>node</code>, we check if the expression of that gene is higher or lower than a given value, if it is lower, we proceed to the left, if not we go right. We keep doing that until we have no more <code>branches</code>. This final node will have a predicted cluster, in this plot we can also see how pure can we expect this group to be and how many of the cells in our training set clasify as part of it.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(tree_fit)</a></code></pre></div>
<p><img src="suggesting_strategies_files/figure-html/unnamed-chunk-4-1.png" width="1152"></p>
<p>When inspecting the tree_fit, we can see a more detailed text representation of this tree.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(tree_fit)</a></code></pre></div>
<pre><code>## 
## Model formula:
## ident ~ MZB1 + CD3G + CD3D + ASNS + CA2 + HEY1
## 
## Fitted party:
## [1] root
## |   [2] CD3D &lt;= 2.30877
## |   |   [3] ASNS &lt;= 1.43241: 0 (n = 37, err = 37.8%)
## |   |   [4] ASNS &gt; 1.43241: 1 (n = 61, err = 16.4%)
## |   [5] CD3D &gt; 2.30877
## |   |   [6] ASNS &lt;= 2.10406: 0 (n = 150, err = 3.3%)
## |   |   [7] ASNS &gt; 2.10406: 1 (n = 7, err = 28.6%)
## 
## Number of inner nodes:    3
## Number of terminal nodes: 4</code></pre>
<p>Sometimes one might think that the proposed strategy is too complicated or not implementable in the experimental settings, in order to add constrians to the fit one can give additional arguments that will be passed to <code><a href="https://rdrr.io/pkg/partykit/man/ctree_control.html">partykit::ctree_control</a></code>, such as <code>maxdepth = 2</code> (maximum 2 questions per cell)</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">tree_fit &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/fit_ctree.html">fit_ctree</a></span>(</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">    small_<span class="dv">5050</span>_mix, <span class="dt">genes_use =</span> top_markers,</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">    <span class="dt">cluster =</span> <span class="st">"ALL"</span>, <span class="dt">maxdepth =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Warning: The following arguments are not used: uniq, cells.use</code></pre>
<pre><code>## Suggested parameter: cells instead of cells.use</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(tree_fit)</a></code></pre></div>
<pre><code>## 
## Model formula:
## ident ~ MZB1 + CD3G + CD3D + ASNS + CA2 + HEY1
## 
## Fitted party:
## [1] root
## |   [2] CD3D &lt;= 2.30877
## |   |   [3] ASNS &lt;= 1.43241: 0 (n = 37, err = 37.8%)
## |   |   [4] ASNS &gt; 1.43241: 1 (n = 61, err = 16.4%)
## |   [5] CD3D &gt; 2.30877
## |   |   [6] ASNS &lt;= 2.10406: 0 (n = 150, err = 3.3%)
## |   |   [7] ASNS &gt; 2.10406: 1 (n = 7, err = 28.6%)
## 
## Number of inner nodes:    3
## Number of terminal nodes: 4</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(tree_fit)</a></code></pre></div>
<p><img src="suggesting_strategies_files/figure-html/unnamed-chunk-6-1.png" width="1152"></p>
<p>Since not all variables are ultimately used in our classifier, one can acces the ones that were by using <code>varimp(tree_fit)</code></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">partykit<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/partykit/man/varimp.html">varimp</a></span>(tree_fit)</a></code></pre></div>
<pre><code>##      CD3D      ASNS 
## 0.2849840 0.1505534</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="../../reference/plot_flowstyle.html">plot_flowstyle</a></span>(small_<span class="dv">5050</span>_mix, <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(partykit<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/partykit/man/varimp.html">varimp</a></span>(tree_fit)))</a></code></pre></div>
<pre><code>## Warning: The following arguments are not used: uniq, cells.use</code></pre>
<pre><code>## Suggested parameter: cells instead of cells.use</code></pre>
<p><img src="suggesting_strategies_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>One can also request the package to suggest a specific strategy only for a given cluster. This function is not expected to give drastically different results in datasets with few clusters, but it can definitely come usefull when many clusters are present and one is interested in a specific one.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">tree_fit &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/fit_ctree.html">fit_ctree</a></span>(small_<span class="dv">5050</span>_mix, <span class="dt">genes_use =</span> top_markers, <span class="dt">cluster =</span> <span class="st">"0"</span>)</a></code></pre></div>
<pre><code>## Warning: The following arguments are not used: uniq, cells.use</code></pre>
<pre><code>## Suggested parameter: cells instead of cells.use</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(tree_fit)</a></code></pre></div>
<pre><code>## 
## Model formula:
## ident ~ MZB1 + CD3G + CD3D + ASNS + CA2 + HEY1
## 
## Fitted party:
## [1] root
## |   [2] CD3D &lt;= 2.30877
## |   |   [3] ASNS &lt;= 1.43241: clus 0 (n = 37, err = 37.8%)
## |   |   [4] ASNS &gt; 1.43241: not clus 0 (n = 61, err = 16.4%)
## |   [5] CD3D &gt; 2.30877
## |   |   [6] ASNS &lt;= 2.10406: clus 0 (n = 150, err = 3.3%)
## |   |   [7] ASNS &gt; 2.10406: not clus 0 (n = 7, err = 28.6%)
## 
## Number of inner nodes:    3
## Number of terminal nodes: 4</code></pre>
<p>Sometimes it is useful to visualize directly the subset of cells that will be “gated” out in each rule, this can be easily achieved by using our implementation of <code>plot_gates</code></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw"><a href="../../reference/plot_gates.html">plot_gates</a></span>(small_<span class="dv">5050</span>_mix, tree_fit, <span class="st">"6"</span>)</a></code></pre></div>
<pre><code>## Warning: The following arguments are not used: uniq, cells.use</code></pre>
<pre><code>## Suggested parameter: cells instead of cells.use</code></pre>
<p><img src="suggesting_strategies_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>We have also implemented a way to export these rules as a <code>garnett</code> classifier. for more detail on how the calssifier is implemented please refer to <a href="https://cole-trapnell-lab.github.io/garnett/docs/#constructing-a-marker-file">the garnett documentation</a></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw"><a href="../../reference/as.garnett.html">as.garnett</a></span>(tree_fit)</a></code></pre></div>
<pre><code>## &gt; clus 0_node_3  (n = 37)
## expressed below: ASNS 1.432, CD3D 2.309
## 
## &gt; clus 0_node_6  (n = 150)
## expressed above: CD3D 2.309
## expressed below: ASNS 2.104
## 
## &gt; not clus 0_node_4  (n = 61)
## expressed above: ASNS 1.432
## expressed below: CD3D 2.309
## 
## &gt; not clus 0_node_7  (n = 7)
## expressed above: ASNS 2.104, CD3D 2.309</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#suggesting-a-gating-strategy-for-the-markers">Suggesting a gating strategy for the markers</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by J. Sebastian Paez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
